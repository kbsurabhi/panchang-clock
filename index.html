<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ea580c">
    <meta name="description" content="Indian Panchang Digital Clock with Tithi, Nakshatra, Muhurat timings">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Panchang Clock</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script>
        const { useState, useEffect, createElement: e } = React;

        function PanchangClock() {
            const [time, setTime] = useState(new Date());
            const [location, setLocation] = useState(() => {
                const saved = localStorage.getItem('panchangLocation');
                return saved ? JSON.parse(saved) : { lat: 28.6139, lon: 77.2090, name: 'New Delhi' };
            });
            const [showSettings, setShowSettings] = useState(false);
            const [tempLocation, setTempLocation] = useState({ ...location });

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                localStorage.setItem('panchangLocation', JSON.stringify(location));
            }, [location]);

            const calculateSunTimes = (date, lat, lon) => {
                const J2000 = 2451545.0;
                const deg2rad = Math.PI / 180;
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
                const n = dayOfYear + (12 - date.getTimezoneOffset() / 60) / 24;
                const J = J2000 + n;
                const M = (357.5291 + 0.98560028 * (J - J2000)) % 360;
                const C = 1.9148 * Math.sin(M * deg2rad) + 0.0200 * Math.sin(2 * M * deg2rad);
                const lambda = (M + C + 180 + 102.9372) % 360;
                const Jnoon = J2000 + n + 0.0053 * Math.sin(M * deg2rad) - 0.0069 * Math.sin(2 * lambda * deg2rad);
                const dec = Math.asin(Math.sin(lambda * deg2rad) * Math.sin(23.44 * deg2rad)) / deg2rad;
                const omega = Math.acos((Math.sin(-0.83 * deg2rad) - Math.sin(lat * deg2rad) * Math.sin(dec * deg2rad)) /
                    (Math.cos(lat * deg2rad) * Math.cos(dec * deg2rad))) / deg2rad;
                const Jrise = Jnoon - omega / 360;
                const Jset = Jnoon + omega / 360;
                const riseTime = new Date(date);
                const setTime = new Date(date);
                const riseHours = ((Jrise - J2000 - n) * 24 + 12) % 24;
                const setHours = ((Jset - J2000 - n) * 24 + 12) % 24;
                riseTime.setHours(Math.floor(riseHours), Math.round((riseHours % 1) * 60), 0);
                setTime.setHours(Math.floor(setHours), Math.round((setHours % 1) * 60), 0);
                return { sunrise: riseTime, sunset: setTime };
            };

            const calculateTithi = (date) => {
                const tithiNames = ['Pratipada', 'Dwitiya', 'Tritiya', 'Chaturthi', 'Panchami',
                    'Shashthi', 'Saptami', 'Ashtami', 'Navami', 'Dashami',
                    'Ekadashi', 'Dwadashi', 'Trayodashi', 'Chaturdashi', 'Purnima'];
                const daysSinceNewMoon = ((date.getTime() / 86400000) + 10) % 29.53;
                const tithiIndex = Math.floor(daysSinceNewMoon / 29.53 * 15) % 15;
                const paksha = daysSinceNewMoon < 14.765 ? 'Shukla' : 'Krishna';
                return { name: tithiNames[tithiIndex], paksha };
            };

            const calculateNakshatra = (date) => {
                const nakshatras = ['Ashwini', 'Bharani', 'Krittika', 'Rohini', 'Mrigashira',
                    'Ardra', 'Punarvasu', 'Pushya', 'Ashlesha', 'Magha',
                    'Purva Phalguni', 'Uttara Phalguni', 'Hasta', 'Chitra', 'Swati',
                    'Vishakha', 'Anuradha', 'Jyeshtha', 'Mula', 'Purva Ashadha',
                    'Uttara Ashadha', 'Shravana', 'Dhanishta', 'Shatabhisha',
                    'Purva Bhadrapada', 'Uttara Bhadrapada', 'Revati'];
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
                const nakshatraIndex = Math.floor((dayOfYear * 13.3 + date.getHours() / 24 * 13.3) % 27);
                return nakshatras[nakshatraIndex];
            };

            const getYoga = (date) => {
                const yogas = ['Vishkambha', 'Priti', 'Ayushman', 'Saubhagya', 'Shobhana',
                    'Atiganda', 'Sukarman', 'Dhriti', 'Shula', 'Ganda',
                    'Vriddhi', 'Dhruva', 'Vyaghata', 'Harshana', 'Vajra',
                    'Siddhi', 'Vyatipata', 'Variyan', 'Parigha', 'Shiva',
                    'Siddha', 'Sadhya', 'Shubha', 'Shukla', 'Brahma', 'Indra', 'Vaidhriti'];
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
                const yogaIndex = Math.floor((dayOfYear * 13.5 + date.getHours() / 24 * 13.5) % 27);
                return yogas[yogaIndex];
            };

            const getKarana = (date) => {
                const karanas = ['Bava', 'Balava', 'Kaulava', 'Taitila', 'Garija',
                    'Vanija', 'Vishti', 'Shakuni', 'Chatushpada', 'Naga', 'Kimstughna'];
                const hourFraction = date.getHours() / 12;
                const karanaIndex = Math.floor((hourFraction * 7)) % 11;
                return karanas[karanaIndex];
            };

            const calculateRahuKaal = (sunrise, sunset) => {
                const dayOfWeek = time.getDay();
                const dayDuration = (sunset - sunrise) / (1000 * 60);
                const oneEighth = dayDuration / 8;
                const rahuKaalPeriods = [7, 1, 6, 4, 5, 3, 2];
                const period = rahuKaalPeriods[dayOfWeek];
                const start = new Date(sunrise.getTime() + (period - 1) * oneEighth * 60000);
                const end = new Date(sunrise.getTime() + period * oneEighth * 60000);
                return { start, end };
            };

            const calculateGulikaKaal = (sunrise, sunset) => {
                const dayOfWeek = time.getDay();
                const dayDuration = (sunset - sunrise) / (1000 * 60);
                const oneEighth = dayDuration / 8;
                const gulikaKaalPeriods = [6, 5, 4, 3, 2, 1, 7];
                const period = gulikaKaalPeriods[dayOfWeek];
                const start = new Date(sunrise.getTime() + (period - 1) * oneEighth * 60000);
                const end = new Date(sunrise.getTime() + period * oneEighth * 60000);
                return { start, end };
            };

            // --- Indian year (Samvatsara) and Uttarayan/Dakshinayan helpers ---
            const samvatsaraNames = [
                'Prabhava', 'Vibhava', 'Shukla', 'Pramodutha', 'Prajothpatti', 'Angirasa', 'Shrimukha', 'Bhava', 'Yuva', 'Dhata',
                'Isha', 'Vikrama', 'Vrisha', 'Chitrabhanu', 'Subhanu', 'Tarana', 'Parthiva', 'Vyaya', 'Sarvajit', 'Sarvadhari',
                'Virodhi', 'Vikruti', 'Khara', 'Nandana', 'Vijaya', 'Jaya', 'Manmatha', 'Durmukha', 'Hemalamba', 'Vilambi',
                'Vikala', 'Sharvari', 'Plava', 'Shubhakrit', 'Shobhakrit', 'Krodhi', 'Vishvavasu', 'Parabhava', 'Plavanga', 'Kilaka',
                'Saumya', 'Sadharana', 'Virodhikrith', 'Paridhavi', 'Pramadi', 'Ananda', 'Raksasa', 'Nala', 'Pingala', 'Kalayukti',
                'Siddharthi', 'Raudra', 'Durmati', 'Dundubhi', 'Rudhirodgari', 'Raktakshi', 'Krodhana', 'Akshaya', 'Naya', 'Purusottama'
            ];

            // Anchor mapping: index 0 corresponds to anchorYear's samvatsara = 'Prabhava'.
            // Adjust anchorYear if you need a different known mapping.
            const samvatsaraAnchorYear = 1987; // change if you have a different epoch mapping

            function getSamvatsara(date) {
                const y = date.getFullYear();
                let idx = (y - samvatsaraAnchorYear) % 60;
                if (idx < 0) idx += 60;
                return samvatsaraNames[idx];
            }

            // Compute approximate solar ecliptic longitude used earlier (same small-algorithm)
            function solarEclipticLongitude(date) {
                const deg2rad = Math.PI / 180;
                const J2000 = 2451545.0;
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
                const n = dayOfYear + (12 - date.getTimezoneOffset() / 60) / 24;
                const J = J2000 + n;
                const M = (357.5291 + 0.98560028 * (J - J2000)) % 360;
                const C = 1.9148 * Math.sin(M * deg2rad) + 0.0200 * Math.sin(2 * M * deg2rad);
                // mean longitude of perihelion etc. similar to earlier
                const lambda = (M + C + 180 + 102.9372) % 360;
                return lambda;
            }

            function sunDeclination(date) {
                const deg2rad = Math.PI / 180;
                const lambda = solarEclipticLongitude(date);
                const dec = Math.asin(Math.sin(lambda * deg2rad) * Math.sin(23.44 * deg2rad));
                return dec; // radians
            }

            function isUttarayan(date) {
                const today = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12); // midday for stability
                const yesterday = new Date(today.getTime() - 24 * 3600 * 1000);
                const decToday = sunDeclination(today);
                const decYesterday = sunDeclination(yesterday);
                return decToday >= decYesterday ? 'Uttarayan' : 'Dakshinayan';
            }

            // --- end helpers ---
            const samvatsara = getSamvatsara(time);
            const uttarDakshin = isUttarayan(time);
            const getHinduMonth = (date) => {
                const months = ['Chaitra', 'Vaishakha', 'Jyeshtha', 'Ashadha',
                    'Shravana', 'Bhadrapada', 'Ashwin', 'Kartik',
                    'Margashirsha', 'Pausha', 'Magha', 'Phalguna'];
                const month = date.getMonth();
                const adjustedMonth = (month + 10) % 12;
                return months[adjustedMonth];
            };

            const formatTime = (date) => {
                return date.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true });
            };

            const sunTimes = calculateSunTimes(time, location.lat, location.lon);
            const rahuKaal = calculateRahuKaal(sunTimes.sunrise, sunTimes.sunset);
            const gulikaKaal = calculateGulikaKaal(sunTimes.sunrise, sunTimes.sunset);
            const tithi = calculateTithi(time);

            const hours = time.getHours().toString().padStart(2, '0');
            const minutes = time.getMinutes().toString().padStart(2, '0');
            const seconds = time.getSeconds().toString().padStart(2, '0');
            const dateStr = time.toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            return e('div', { className: 'min-h-screen bg-gradient-to-br from-orange-50 via-yellow-50 to-red-50 p-4 md:p-8' },
                e('div', { className: 'max-w-6xl mx-auto' },
                    e('div', { className: 'flex justify-between items-center mb-6' },
                        e('div', { className: 'flex items-center gap-2' },
                            e('span', { className: 'text-2xl' }, 'ðŸ“'),
                            e('span', { className: 'text-sm text-gray-700 font-medium' }, location.name)
                        ),
                        e('button', {
                            onClick: () => setShowSettings(!showSettings),
                            className: 'flex items-center gap-2 bg-white px-4 py-2 rounded-lg shadow hover:shadow-md transition-all'
                        },
                            e('span', { className: 'text-xl' }, 'âš™ï¸'),
                            e('span', { className: 'text-sm' }, 'Settings')
                        )
                    ),
                    showSettings && e('div', { className: 'bg-white rounded-2xl shadow-xl p-6 mb-6' },
                        e('h3', { className: 'text-xl font-bold text-gray-800 mb-4' }, 'Location Settings'),
                        e('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4 mb-4' },
                            e('div', null,
                                e('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Location Name'),
                                e('input', {
                                    type: 'text',
                                    value: tempLocation.name,
                                    onChange: (ev) => setTempLocation({ ...tempLocation, name: ev.target.value }),
                                    className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500'
                                })
                            ),
                            e('div', null,
                                e('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Latitude'),
                                e('input', {
                                    type: 'number',
                                    step: '0.0001',
                                    value: tempLocation.lat,
                                    onChange: (ev) => setTempLocation({ ...tempLocation, lat: parseFloat(ev.target.value) }),
                                    className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500'
                                })
                            ),
                            e('div', null,
                                e('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Longitude'),
                                e('input', {
                                    type: 'number',
                                    step: '0.0001',
                                    value: tempLocation.lon,
                                    onChange: (ev) => setTempLocation({ ...tempLocation, lon: parseFloat(ev.target.value) }),
                                    className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500'
                                })
                            )
                        ),
                        e('button', {
                            onClick: () => { setLocation({ ...tempLocation }); setShowSettings(false); },
                            className: 'bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-all'
                        }, 'Update Location')
                    ),
                    e('div', { className: 'bg-white rounded-3xl shadow-2xl p-6 md:p-8 mb-6 border-4 border-orange-200' },
                        e('div', { className: 'text-center mb-6' },
                            e('div', { className: 'flex items-center justify-center gap-3 mb-4' },
                                e('span', { className: 'text-4xl' }, 'â˜€ï¸'),
                                e('h1', { className: 'text-2xl md:text-3xl font-bold text-orange-800' }, 'Daily Panchang'),
                                e('span', { className: 'text-4xl' }, 'ðŸŒ™')
                            ),
                            e('p', { className: 'text-sm text-gray-600' }, 'Indian Panchang Digital Clock')
                        ),
                        e('div', { className: 'bg-gradient-to-r from-orange-600 to-red-600 rounded-2xl p-6 md:p-8 mb-6 shadow-lg' },
                            e('div', { className: 'text-center' },
                                e('div', { className: 'text-5xl md:text-7xl font-bold text-white font-mono tracking-wider mb-2' },
                                    `${hours}:${minutes}:${seconds}`
                                ),
                                e('div', { className: 'text-lg md:text-xl text-orange-100' }, dateStr)
                            )
                        ),
                        e('div', { className: 'grid grid-cols-2 gap-4 mb-6' },
                            e('div', { className: 'bg-gradient-to-br from-yellow-50 to-orange-100 rounded-xl p-4 border-2 border-orange-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-2xl' }, 'ðŸŒ…'),
                                    e('h3', { className: 'font-semibold text-orange-800' }, 'Sunrise: ')
                                ),
                                e('p', { className: 'text-2xl font-bold text-orange-900' }, formatTime(sunTimes.sunrise))
                            ),
                            e('div', { className: 'bg-gradient-to-br from-blue-50 to-indigo-100 rounded-xl p-4 border-2 border-indigo-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-2xl' }, 'ðŸŒ†'),
                                    e('h3', { className: 'font-semibold text-indigo-800' }, 'Sunset: ')
                                ),
                                e('p', { className: 'text-2xl font-bold text-indigo-900' }, formatTime(sunTimes.sunset))
                            )
                        ),
                        e('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4' },

                            e('div', { className: 'bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-4 border-2 border-yellow-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-xl' }, 'ðŸ•‰ï¸'),
                                    e('h3', { className: 'font-semibold text-yellow-800' }, 'Samvatsara / Ayanam: ')
                                ),
                                e('p', { className: 'text-lg font-semibold text-yellow-900 mb-1' }, samvatsara),
                                e('p', { className: 'text-sm text-yellow-800' }, uttarDakshin)
                            ),
                            e('div', { className: 'bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border-2 border-purple-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-xl' }, 'ðŸŒ™'),
                                    e('h3', { className: 'font-semibold text-purple-800' }, 'Tithi: ')
                                ),
                                e('p', { className: 'text-xl font-bold text-purple-900' }, `${tithi.paksha} ${tithi.name}`)
                            ),
                            e('div', { className: 'bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border-2 border-blue-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-xl' }, 'â­'),
                                    e('h3', { className: 'font-semibold text-blue-800' }, 'Nakshatra: ')
                                ),
                                e('p', { className: 'text-xl font-bold text-blue-900' }, calculateNakshatra(time))
                            ),
                            e('div', { className: 'bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-4 border-2 border-orange-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-xl' }, 'ðŸ“…'),
                                    e('h3', { className: 'font-semibold text-orange-800' }, 'Maasa: ')
                                ),
                                e('p', { className: 'text-xl font-bold text-orange-900' }, getHinduMonth(time))
                            ),
                            e('div', { className: 'bg-gradient-to-br from-pink-50 to-pink-100 rounded-xl p-4 border-2 border-pink-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-xl' }, 'â˜€ï¸'),
                                    e('h3', { className: 'font-semibold text-pink-800' }, 'Yoga: ')
                                ),
                                e('p', { className: 'text-xl font-bold text-pink-900' }, getYoga(time))
                            ),
                            e('div', { className: 'bg-gradient-to-br from-indigo-50 to-indigo-100 rounded-xl p-4 border-2 border-indigo-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-xl' }, 'âœ¨'),
                                    e('h3', { className: 'font-semibold text-indigo-800' }, 'Karana: ')
                                ),
                                e('p', { className: 'text-xl font-bold text-indigo-900' }, getKarana(time))
                            ),
                            e('div', { className: 'bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border-2 border-green-200' },
                                e('div', { className: 'flex items-center gap-2 mb-2' },
                                    e('span', { className: 'text-xl' }, 'ðŸ“†'),
                                    e('h3', { className: 'font-semibold text-green-800' }, 'Vaara: ')
                                ),
                                e('p', { className: 'text-xl font-bold text-green-900' }, time.toLocaleDateString('en-IN', { weekday: 'long' }))
                            )
                        )
                    ),
                    e('div', { className: 'bg-white rounded-3xl shadow-2xl p-6 md:p-8 mb-6 border-4 border-red-200' },
                        e('div', { className: 'flex items-center gap-2 mb-6' },
                            e('span', { className: 'text-2xl' }, 'â°'),
                            e('h2', { className: 'text-2xl font-bold text-red-800' }, 'Inauspicious Timings: ')
                        ),
                        e('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                            e('div', { className: 'bg-gradient-to-br from-red-50 to-red-100 rounded-xl p-4 border-2 border-red-300' },
                                e('h3', { className: 'font-semibold text-red-800 mb-2' }, 'Rahu Kaal: '),
                                e('p', { className: 'text-lg font-bold text-red-900' }, `${formatTime(rahuKaal.start)} - ${formatTime(rahuKaal.end)}`),
                                e('p', { className: 'text-xs text-red-700 mt-1' }, 'Avoid starting new ventures')
                            ),
                            e('div', { className: 'bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border-2 border-gray-300' },
                                e('h3', { className: 'font-semibold text-gray-800 mb-2' }, 'Gulika Kaal: '),
                                e('p', { className: 'text-lg font-bold text-gray-900' }, `${formatTime(gulikaKaal.start)} - ${formatTime(gulikaKaal.end)}`),
                                e('p', { className: 'text-xs text-gray-700 mt-1' }, 'Inauspicious period')
                            )
                        )
                    ),
                    e('div', { className: 'bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 text-center' },
                        e('p', { className: 'text-sm text-yellow-800' },
                            e('strong', null, 'Note: '),
                            'This Panchang uses astronomical calculations for your location. For precise calculations and auspicious muhurat timings specific to important events, please consult a professional astrologer or authentic Panchang for your region.'
                        )
                    )
                )
            );
        }

        ReactDOM.render(e(PanchangClock), document.getElementById('root'));

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>

</html>